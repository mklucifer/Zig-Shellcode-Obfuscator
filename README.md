# Zig Shellcode Obfuscator

A Zig-based tool for obfuscating shellcode using XOR obfuscation with key rotation and position-based scrambling. This tool converts hex string shellcode into encrypted binary data and generates complete, ready-to-compile Zig programs for secure shellcode execution.

## Features

- **XOR Obfuscation**: Uses XOR with rotating 32-byte key and position-based scrambling
- **Hex String Input**: Accepts shellcode in hex format (e.g., `0xfc, 0x48, 0x83, ...`)
- **Complete Program Generation**: Outputs self-contained Zig programs ready to compile
- **Windows API Integration**: Includes proper memory allocation and thread-based execution
- **Memory Safety**: Comprehensive error handling and cleanup
- **Timeout Protection**: 5-second execution timeout to prevent hanging
- **Debug Output**: Detailed logging for troubleshooting

## Installation

Ensure you have Zig installed (tested with Zig 0.14.1):

```bash
# Download Zig from https://ziglang.org/download/
# Add Zig to your PATH
zig version  # Verify installation
```

## Usage

### Run the Obfuscator
```
./XOR_Shellcode_Obfuscator.exe shellcode.txt
```

## How It Works

### Encryption Process

1. **Hex Parsing**: Converts hex string input to binary bytes
2. **Padding**: Pads shellcode to 16-byte blocks using PKCS#7
3. **Key Generation**: Creates random 32-byte encryption key
4. **XOR Encryption**: Applies XOR with rotating key and position-based obfuscation:
   ```zig
   encrypted[i] = data[i] ^ key[i % key.len] ^ @as(u8, @truncate(i));
   ```

### Decryption Process

The generated program includes decryption logic that:

1. **Reverses XOR**: Applies same XOR operations in reverse
2. **Removes Padding**: Strips PKCS#7 padding to original size
3. **Memory Allocation**: Uses `VirtualAlloc` with execute permissions
4. **Safe Execution**: Runs shellcode in separate thread with timeout

### Security Features

- **Obfuscation**: Original shellcode is completely encrypted
- **Runtime Decryption**: Shellcode only exists in plaintext during execution
- **Memory Protection**: Proper Windows API usage for executable memory
- **Thread Isolation**: Shellcode runs in separate thread
- **Timeout Protection**: Prevents infinite loops or hanging

## Example Output

```
=== XOR Shellcode Encryptor ===
Paste your hex shellcode (e.g., 0xfc, 0x48, 0x83, ...):
Converting hex string to binary...
Parsed 276 bytes of shellcode
Encrypting shellcode...
Shellcode encrypted successfully!
Generating complete Zig program...

================================================================================
// XOR-Encrypted Shellcode - Generated by Zig Shellcode Encryptor
// Copy this entire program into a .zig file and compile
...
================================================================================

Complete! Copy the generated program above into a .zig file and compile.
```

## Technical Details

### Encryption Algorithm

- **Method**: XOR with key rotation and position-based obfuscation
- **Key Size**: 32 bytes (256 bits)
- **Padding**: PKCS#7 to 16-byte blocks
- **Position Factor**: Each byte XORed with its position for additional obfuscation

### Windows API Usage

- `VirtualAlloc`: Allocates executable memory pages
- `CreateThread`: Creates new thread for shellcode execution
- `WaitForSingleObject`: Waits for thread completion with timeout
- `CloseHandle`: Cleans up thread handle
- `VirtualFree`: Releases allocated memory

### Memory Safety

- Proper allocation and deallocation
- Error handling for all Windows API calls
- Bounds checking for array operations
- Timeout protection against infinite loops

## Limitations

- **Windows Only**: Uses Windows-specific APIs
- **Architecture Dependent**: Shellcode must match target architecture
- **Shellcode Validity**: Input shellcode must be valid machine code
- **Memory Permissions**: Requires ability to allocate executable memory

## Security Considerations

⚠️ **Warning**: This tool is for educational and authorized testing purposes only.

- Ensure shellcode is from trusted sources
- Test in isolated environments
- Verify shellcode compatibility with target system
- Be aware of antivirus detection possibilities
- Use only for legitimate security research

## Troubleshooting

### Common Issues

1. **Compilation Errors**: Ensure Zig 0.14.1 or compatible version
2. **Runtime Crashes**: Verify shellcode is valid for target architecture
3. **Memory Errors**: Check available memory and permissions
4. **Timeout Issues**: Shellcode may be incompatible or malformed

### Debug Output

The generated programs include debug output:
```
Decrypted shellcode length: 276
```
